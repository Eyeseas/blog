<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="keywords" content="ESLint中文, ESLint中文网, ESLint规则, ESLint配置, 代码检测, 代码质量, JavaScript, Linter, Linting, Pluggable, Configurable, Code Quality">
  <meta name="description" content="ESLint中文官网, ESLint中英文对照, JavaScript代码检测, JavaScript代码风格检测, JavaScript代码自动格式化,A pluggable and configurable linter tool for identifying and reporting on patterns in JavaScript. Maintain your code quality with ease.">
  <meta name="theme-color" content="#463fd4"/>
  <meta property="og:locale" content="zh_CN">
  <meta property="og:site_name" content="ESLint中文">
  <meta property="og:title" content="Migrating to v4.0.0">
  <meta property="og:url" content="http://localhost:4000/docs/user-guide/migrating-to-4.0.0">
  <meta property="og:image" content="http://localhost:4000/img/favicon.512x512.png">

  <meta name="twitter:site" content="@geteslint">
  <meta name="twitter:title" content="Migrating to v4.0.0">
  <meta name="twitter:description" content="ESLint中文官网, ESLint中英文对照, JavaScript代码检测, JavaScript代码风格检测, JavaScript代码自动格式化,A pluggable and configurable linter tool for identifying and reporting on patterns in JavaScript. Maintain your code quality with ease.">
  <meta name="twitter:url" content="http://localhost:4000/docs/user-guide/migrating-to-4.0.0">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:image" content="http://localhost:4000/img/favicon.512x512.png">

    
        <title>Migrating to v4.0.0 - ESLint中文</title>
    


  <link href="http://localhost:4000/docs/user-guide/migrating-to-4.0.0" rel="canonical" />
  <link rel="stylesheet" href="/styles/main.css"/>
  
  <link rel='manifest' href='http://localhost:4000/manifest.json'>
  <link rel="icon" href="http://localhost:4000/img/favicon.512x512.png">
  <link rel="alternate" type="application/rss+xml" title="ESLint中文" href="http://localhost:4000/feed.xml">
  <!-- at the end of the HEAD -->
  <link rel="stylesheet" href="/styles/vendor/docsearch.min.css" />
</head>
<body>

<input type="checkbox" id="eslint-toggle-search" class="eslint-toggle-search-checkbox" />
<header class="navbar navbar-default navbar-demo navbar-fixed-top eslint-nav" id="top" role="banner">
  <div class="container">

    <a href="http://localhost:4000/" class="navbar-brand"><img alt="ESLint" src="http://localhost:4000/img/logo.svg" itemprop="image">ESLint</a>

    <div class="eslint-navbar-toggles">
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#eslint-navbar" aria-controls="eslint-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <label for="eslint-toggle-search" class="navbar-toggle eslint-toggle-search-open">
        <span class="sr-only">Open search</span>
        <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
      </label>
    </div>

    <nav id="eslint-navbar" class="collapse navbar-collapse eslint-navbar">
      
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <a href="http://localhost:4000/docs/user-guide" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">用户指南<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="http://localhost:4000/docs/user-guide/getting-started">开始</a></li>
            <li><a href="http://localhost:4000/docs/user-guide/configuring">配置</a></li>
            <li><a href="http://localhost:4000/docs/user-guide/command-line-interface">命令行</a></li>
            <li><a href="http://localhost:4000/docs/rules/">规则</a></li>
            <li><a href="http://localhost:4000/docs/user-guide/formatters">Formatters</a></li>
            <li><a href="http://localhost:4000/docs/user-guide/integrations">集成</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="http://localhost:4000/docs/developer-guide" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">开发指南<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="http://localhost:4000/docs/developer-guide/architecture">架构</a></li>
            <li><a href="http://localhost:4000/docs/developer-guide/source-code">源码</a></li>
            <li><a href="http://localhost:4000/docs/developer-guide/development-environment">开发环境</a></li>
            <li><a href="http://localhost:4000/docs/developer-guide/contributing">参与</a></li>
            <li><a href="http://localhost:4000/docs/developer-guide/unit-tests">单元测试</a></li>
            <li><a href="http://localhost:4000/docs/developer-guide/working-with-rules">创建规则</a></li>
            <li><a href="http://localhost:4000/docs/developer-guide/working-with-custom-formatters">自定义格式化器</a></li>
            <li><a href="http://localhost:4000/docs/developer-guide/working-with-custom-parsers">自定义解析器</a></li>
            <li><a href="http://localhost:4000/docs/developer-guide/working-with-plugins">开发插件</a></li>
            <li><a href="http://localhost:4000/docs/developer-guide/shareable-configs">可共享的配置</a></li>
            <li><a href="http://localhost:4000/docs/developer-guide/nodejs-api">Node.js API</a></li>
            <li><a href="http://localhost:4000/docs/maintainer-guide">维护者指南</a></li>
          </ul>
        </li>
        <li><a href="http://localhost:4000/blog/">博客</a></li>
        <li class="dropdown">
          <a href="http://localhost:4000/demo" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">演示<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="http://localhost:4000/demo/">ESLint Demo</a></li>
            <li><a href="http://localhost:4000/parser/">Espree Demo</a></li>
          </ul>
        </li>
        <!-- <li><a href="http://localhost:4000/docs/about/">About</a></li> -->
        <li class="dropdown">
          <a href="http://localhost:4000/docs/about/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">关于<span
              class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="http://localhost:4000/users/">谁在使用 ESLint?</a></li>
            <li><a href="http://localhost:4000/team/">关于 Team</a></li>
            <li><a href="http://localhost:4000/docs/about/">关于 ESLint</a></li>
          </ul>
        </li>
      </ul>

      <label for="eslint-toggle-search" class="navbar-toggle eslint-toggle-search-open">
        <span class="sr-only">Open search</span>
        <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
      </label>

      <div class="navbar-form navbar-right eslint-search" role="search">
        <div class="input-group">
          <label class="sr-only" aria-label="Search" for="eslint-search-input">Search</label>
          <div class="eslint-search-input-wrapper">
            <input type="text" class="form-control" id="eslint-search-input" accesskey="s" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search the docs...">
            <label for="eslint-toggle-search" class="eslint-toggle-search-close">
              <span class="sr-only">Close search</span>
              <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>
            </label>
          </div>
        </div>
      </div>
    </nav>

  </div><!-- /.container -->
</header><!-- /.navbar -->

<main class="doc">
  <article class="container">
    <!-- Note: No pull requests accepted for this file. See README.md in the root directory for details. -->

<h1 id="migrating-to-v400">Migrating to v4.0.0</h1>

<p>ESLint v4.0.0 is the fourth major version release. We have made several breaking changes in this release; however, we expect that most of the changes will only affect a very small percentage of users. This guide is intended to walk you through the changes.</p>

<p>The lists below are ordered roughly by the number of users each change is expected to affect, where the first items are expected to affect the most users.</p>

<h3 id="breaking-changes-for-users">Breaking changes for users</h3>

<ol>
  <li><a href="#eslint-recommended-changes">New rules have been added to <code class="language-plaintext highlighter-rouge">eslint:recommended</code></a></li>
  <li><a href="#indent-rewrite">The <code class="language-plaintext highlighter-rouge">indent</code> rule is more strict</a></li>
  <li><a href="#config-validation">Unrecognized properties in config files now cause a fatal error</a></li>
  <li><a href="#eslintignore-patterns">.eslintignore patterns are now resolved from the location of the file</a></li>
  <li><a href="#padded-blocks-defaults">The <code class="language-plaintext highlighter-rouge">padded-blocks</code> rule is more strict by default</a></li>
  <li><a href="#space-before-function-paren-defaults">The <code class="language-plaintext highlighter-rouge">space-before-function-paren</code> rule is more strict by default</a></li>
  <li><a href="#no-multi-spaces-eol-comments">The <code class="language-plaintext highlighter-rouge">no-multi-spaces</code> rule is more strict by default</a></li>
  <li><a href="#scoped-plugin-resolution">References to scoped plugins in config files are now required to include the scope</a></li>
</ol>

<h3 id="breaking-changes-for-plugincustom-rule-developers">Breaking changes for plugin/custom rule developers</h3>

<ol>
  <li><a href="#rule-tester-validation"><code class="language-plaintext highlighter-rouge">RuleTester</code> now validates properties of test cases</a></li>
  <li><a href="#comment-attachment">AST nodes no longer have comment properties</a></li>
  <li><a href="#event-comments"><code class="language-plaintext highlighter-rouge">LineComment</code> and <code class="language-plaintext highlighter-rouge">BlockComment</code> events will no longer be emitted during AST traversal</a></li>
  <li><a href="#shebangs">Shebangs are now returned from comment APIs</a></li>
</ol>

<h3 id="breaking-changes-for-integration-developers">Breaking changes for integration developers</h3>

<ol>
  <li><a href="#global-property">The <code class="language-plaintext highlighter-rouge">global</code> property in the <code class="language-plaintext highlighter-rouge">linter.verify()</code> API is no longer supported</a></li>
  <li><a href="#report-locations">More report messages now have full location ranges</a></li>
  <li><a href="#exposed-es2015-classes">Some exposed APIs are now ES2015 classes</a></li>
</ol>

<hr />

<h2 id="-eslintrecommended-changes"><a name="eslint-recommended-changes"></a> <code class="language-plaintext highlighter-rouge">eslint:recommended</code> changes</h2>

<p>Two new rules have been added to the <a href="https://eslint.org/docs/user-guide/configuring#using-eslintrecommended"><code class="language-plaintext highlighter-rouge">eslint:recommended</code></a> config:</p>

<ul>
  <li><a href="/docs/rules/no-compare-neg-zero"><code class="language-plaintext highlighter-rouge">no-compare-neg-zero</code></a> disallows comparisons to <code class="language-plaintext highlighter-rouge">-0</code></li>
  <li><a href="/docs/rules/no-useless-escape"><code class="language-plaintext highlighter-rouge">no-useless-escape</code></a> disallows uselessly-escaped characters in strings and regular expressions</li>
</ul>

<p><strong>To address:</strong> To mimic the <code class="language-plaintext highlighter-rouge">eslint:recommended</code> behavior from 3.x, you can disable these rules in a config file:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"extends"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eslint:recommended"</span><span class="p">,</span><span class="w">

  </span><span class="nl">"rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"no-compare-neg-zero"</span><span class="p">:</span><span class="w"> </span><span class="s2">"off"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"no-useless-escape"</span><span class="p">:</span><span class="w"> </span><span class="s2">"off"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="-the-indent-rule-is-more-strict"><a name="indent-rewrite"></a> The <code class="language-plaintext highlighter-rouge">indent</code> rule is more strict</h2>

<p>Previously, the <a href="/docs/rules/indent"><code class="language-plaintext highlighter-rouge">indent</code></a> rule was fairly lenient about checking indentation; there were many code patterns where indentation was not validated by the rule. This caused confusion for users, because they were accidentally writing code with incorrect indentation, and they expected ESLint to catch the issues.</p>

<p>In 4.0.0, the <code class="language-plaintext highlighter-rouge">indent</code> rule has been rewritten. The new version of the rule will report some indentation errors that the old version of the rule did not catch. Additionally, the indentation of <code class="language-plaintext highlighter-rouge">MemberExpression</code> nodes, function parameters, and function arguments will now be checked by default (it was previously ignored by default for backwards compatibility).</p>

<p>To make the upgrade process easier, we’ve introduced the <a href="/docs/rules/indent-legacy"><code class="language-plaintext highlighter-rouge">indent-legacy</code></a> rule as a snapshot of the <code class="language-plaintext highlighter-rouge">indent</code> rule from 3.x. If you run into issues from the <code class="language-plaintext highlighter-rouge">indent</code> rule when you upgrade, you should be able to use the <code class="language-plaintext highlighter-rouge">indent-legacy</code> rule to replicate the 3.x behavior. However, the <code class="language-plaintext highlighter-rouge">indent-legacy</code> rule is deprecated and will not receive bugfixes or improvements in the future, so you should eventually switch back to the <code class="language-plaintext highlighter-rouge">indent</code> rule.</p>

<p><strong>To address:</strong> We recommend upgrading without changing your <code class="language-plaintext highlighter-rouge">indent</code> configuration, and fixing any new indentation errors that appear in your codebase. However, if you want to mimic how the <code class="language-plaintext highlighter-rouge">indent</code> rule worked in 3.x, you can update your configuration:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="nl">rules</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">indent</span><span class="p">:</span> <span class="dl">"</span><span class="s2">off</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">indent-legacy</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">error</span><span class="dl">"</span> <span class="c1">// replace this with your previous `indent` configuration</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="-unrecognized-properties-in-config-files-now-cause-a-fatal-error"><a name="config-validation"></a> Unrecognized properties in config files now cause a fatal error</h2>

<p>When creating a config, users sometimes make typos or misunderstand how the config is supposed to be structured. Previously, ESLint did not validate the properties of a config file, so a typo in a config could be very tedious to debug. Starting in 4.0.0, ESLint will raise an error if a property in a config file is unrecognized or has the wrong type.</p>

<p><strong>To address:</strong> If you see a config validation error after upgrading, verify that your config doesn’t contain any typos. If you are using an unrecognized property, you should be able to remove it from your config to restore the previous behavior.</p>

<h2 id="-eslintignore-patterns-are-now-resolved-from-the-location-of-the-file"><a name="eslintignore-patterns"></a> .eslintignore patterns are now resolved from the location of the file</h2>

<p>Due to a bug, glob patterns in an <code class="language-plaintext highlighter-rouge">.eslintignore</code> file were previously resolved from the current working directory of the process, rather than the location of the <code class="language-plaintext highlighter-rouge">.eslintignore</code> file. Starting in 4.0, patterns in an <code class="language-plaintext highlighter-rouge">.eslintignore</code> file will be resolved from the <code class="language-plaintext highlighter-rouge">.eslintignore</code> file’s location.</p>

<p><strong>To address:</strong> If you use an <code class="language-plaintext highlighter-rouge">.eslintignore</code> file and you frequently run ESLint from somewhere other than the project root, it’s possible that the patterns will be matched differently. You should update the patterns in the <code class="language-plaintext highlighter-rouge">.eslintignore</code> file to ensure they are relative to the file, not to the working directory.</p>

<h2 id="-the-padded-blocks-rule-is-more-strict-by-default"><a name="padded-blocks-defaults"></a> The <code class="language-plaintext highlighter-rouge">padded-blocks</code> rule is more strict by default</h2>

<p>By default, the <a href="/docs/rules/padded-blocks"><code class="language-plaintext highlighter-rouge">padded-blocks</code></a> rule will now enforce padding in class bodies and switch statements. Previously, the rule would ignore these cases unless the user opted into enforcing them.</p>

<p><strong>To address:</strong> If this change results in more linting errors in your codebase, you should fix them or reconfigure the rule.</p>

<h2 id="-the-space-before-function-paren-rule-is-more-strict-by-default"><a name="space-before-function-paren-defaults"></a> The <code class="language-plaintext highlighter-rouge">space-before-function-paren</code> rule is more strict by default</h2>

<p>By default, the <a href="/docs/rules/space-before-function-paren"><code class="language-plaintext highlighter-rouge">space-before-function-paren</code></a> rule will now enforce spacing for async arrow functions. Previously, the rule would ignore these cases unless the user opted into enforcing them.</p>

<p><strong>To address:</strong> To mimic the default config from 3.x, you can use:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"space-before-function-paren"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"error"</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"anonymous"</span><span class="p">:</span><span class="w"> </span><span class="s2">"always"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"named"</span><span class="p">:</span><span class="w"> </span><span class="s2">"always"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"asyncArrow"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ignore"</span><span class="w">
    </span><span class="p">}]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="-the-no-multi-spaces-rule-is-more-strict-by-default"><a name="no-multi-spaces-eol-comments"></a> The <code class="language-plaintext highlighter-rouge">no-multi-spaces</code> rule is more strict by default</h2>

<p>By default, the <a href="/docs/rules/no-multi-spaces"><code class="language-plaintext highlighter-rouge">no-multi-spaces</code></a> rule will now disallow multiple spaces before comments at the end of a line. Previously, the rule did not check this case.</p>

<p><strong>To address:</strong> To mimic the default config from 3.x, you can use:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"no-multi-spaces"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"error"</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nl">"ignoreEOLComments"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">}]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="-references-to-scoped-plugins-in-config-files-are-now-required-to-include-the-scope"><a name="scoped-plugin-resolution"></a> References to scoped plugins in config files are now required to include the scope</h2>

<p>In 3.x, there was a bug where references to scoped NPM packages as plugins in config files could omit the scope. For example, in 3.x the following config was legal:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"plugins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"@my-organization/foo"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"foo/some-rule"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>In other words, it was possible to reference a rule from a scoped plugin (such as <code class="language-plaintext highlighter-rouge">foo/some-rule</code>) without explicitly stating the <code class="language-plaintext highlighter-rouge">@my-organization</code> scope. This was a bug because it could lead to ambiguous rule references if there was also an unscoped plugin called <code class="language-plaintext highlighter-rouge">eslint-plugin-foo</code> loaded at the same time.</p>

<p>To avoid this ambiguity, in 4.0 references to scoped plugins must include the scope. The config from above should be fixed to:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"plugins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"@my-organization/foo"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"@my-organization/foo/some-rule"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><strong>To address:</strong> If you reference a scoped NPM package as a plugin in a config file, be sure to include the scope wherever you reference it.</p>

<hr />

<h2 id="-ruletester-now-validates-properties-of-test-cases"><a name="rule-tester-validation"></a> <code class="language-plaintext highlighter-rouge">RuleTester</code> now validates properties of test cases</h2>

<p>Starting in 4.0, the <code class="language-plaintext highlighter-rouge">RuleTester</code> utility will validate properties of test case objects, and an error will be thrown if an unknown property is encountered. This change was added because we found that it was relatively common for developers to make typos in rule tests, often invalidating the assertions that the test cases were trying to make.</p>

<p><strong>To address:</strong> If your tests for custom rules have extra properties, you should remove those properties.</p>

<h2 id="-ast-nodes-no-longer-have-comment-properties"><a name="comment-attachment"></a> AST Nodes no longer have comment properties</h2>

<p>Prior to 4.0, ESLint required parsers to implement comment attachment, a process where AST nodes would gain additional properties corresponding to their leading and trailing comments in the source file. This made it difficult for users to develop custom parsers, because they would have to replicate the confusing comment attachment semantics required by ESLint.</p>

<p>In 4.0, we have moved away from the concept of comment attachment and have moved all comment handling logic into ESLint itself. This should make it easier to develop custom parsers, but it also means that AST nodes will no longer have <code class="language-plaintext highlighter-rouge">leadingComments</code> and <code class="language-plaintext highlighter-rouge">trailingComments</code> properties. Conceptually, rule authors can now think of comments in the context of tokens rather than AST nodes.</p>

<p><strong>To address:</strong> If you have a custom rule that depends on the <code class="language-plaintext highlighter-rouge">leadingComments</code> or <code class="language-plaintext highlighter-rouge">trailingComments</code> properties of an AST node, you can now use <code class="language-plaintext highlighter-rouge">sourceCode.getCommentsBefore()</code> and <code class="language-plaintext highlighter-rouge">sourceCode.getCommentsAfter()</code> instead, respectively.</p>

<p>Additionally, the <code class="language-plaintext highlighter-rouge">sourceCode</code> object now also has <code class="language-plaintext highlighter-rouge">sourceCode.getCommentsInside()</code> (which returns all the comments inside a node), <code class="language-plaintext highlighter-rouge">sourceCode.getAllComments()</code> (which returns all the comments in the file), and allows comments to be accessed through various other token iterator methods (such as <code class="language-plaintext highlighter-rouge">getTokenBefore()</code> and <code class="language-plaintext highlighter-rouge">getTokenAfter()</code>) with the <code class="language-plaintext highlighter-rouge">{ includeComments: true }</code> option.</p>

<p>For rule authors concerned about supporting ESLint v3.0 in addition to v4.0, the now deprecated <code class="language-plaintext highlighter-rouge">sourceCode.getComments()</code> is still available and will work for both versions.</p>

<p>Finally, please note that the following <code class="language-plaintext highlighter-rouge">SourceCode</code> methods have been deprecated and will be removed in a future version of ESLint:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">getComments()</code> - replaced by <code class="language-plaintext highlighter-rouge">getCommentsBefore()</code>, <code class="language-plaintext highlighter-rouge">getCommentsAfter()</code>, and <code class="language-plaintext highlighter-rouge">getCommentsInside()</code></li>
  <li><code class="language-plaintext highlighter-rouge">getTokenOrCommentBefore()</code> - replaced by <code class="language-plaintext highlighter-rouge">getTokenBefore()</code> with the <code class="language-plaintext highlighter-rouge">{ includeComments: true }</code> option</li>
  <li><code class="language-plaintext highlighter-rouge">getTokenOrCommentAfter()</code> - replaced by <code class="language-plaintext highlighter-rouge">getTokenAfter()</code> with the <code class="language-plaintext highlighter-rouge">{ includeComments: true }</code> option</li>
</ul>

<h2 id="-linecomment-and-blockcomment-events-will-no-longer-be-emitted-during-ast-traversal"><a name="event-comments"></a> <code class="language-plaintext highlighter-rouge">LineComment</code> and <code class="language-plaintext highlighter-rouge">BlockComment</code> events will no longer be emitted during AST traversal</h2>

<p>Starting in 4.0, <code class="language-plaintext highlighter-rouge">LineComment</code> and <code class="language-plaintext highlighter-rouge">BlockComments</code> events will not be emitted during AST traversal. There are two reasons for this:</p>

<ul>
  <li>This behavior was relying on comment attachment happening at the parser level, which does not happen anymore, to ensure that all comments would be accounted for</li>
  <li>Thinking of comments in the context of tokens is more predictable and easier to reason about than thinking about comment tokens in the context of AST nodes</li>
</ul>

<p><strong>To address:</strong> Instead of relying on <code class="language-plaintext highlighter-rouge">LineComment</code> and <code class="language-plaintext highlighter-rouge">BlockComment</code>, rules can now use <code class="language-plaintext highlighter-rouge">sourceCode.getAllComments()</code> to get all comments in a file. To check all comments of a specific type, rules can use the following pattern:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sourceCode.getAllComments().filter(comment =&gt; comment.type === "Line");
sourceCode.getAllComments().filter(comment =&gt; comment.type === "Block");
</code></pre></div></div>

<h2 id="-shebangs-are-now-returned-from-comment-apis"><a name="shebangs"></a> Shebangs are now returned from comment APIs</h2>

<p>Prior to 4.0, shebang comments in a source file would not appear in the output of <code class="language-plaintext highlighter-rouge">sourceCode.getAllComments()</code> or <code class="language-plaintext highlighter-rouge">sourceCode.getComments()</code>, but they would appear in the output of <code class="language-plaintext highlighter-rouge">sourceCode.getTokenOrCommentBefore</code> as line comments. This inconsistency led to some confusion for rule developers.</p>

<p>In 4.0, shebang comments are treated as comment tokens of type <code class="language-plaintext highlighter-rouge">Shebang</code> and will be returned by any <code class="language-plaintext highlighter-rouge">SourceCode</code> method that returns comments. The goal of this change is to make working with shebang comments more consistent with how other tokens are handled.</p>

<p><strong>To address:</strong> If you have a custom rule that performs operations on comments, some additional logic might be required to ensure that shebang comments are correctly handled or filtered out:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sourceCode.getAllComments().filter(comment =&gt; comment.type !== "Shebang");
</code></pre></div></div>

<hr />

<h2 id="-the-global-property-in-the-linterverify-api-is-no-longer-supported"><a name="global-property"></a> The <code class="language-plaintext highlighter-rouge">global</code> property in the <code class="language-plaintext highlighter-rouge">linter.verify()</code> API is no longer supported</h2>

<p>Previously, the <code class="language-plaintext highlighter-rouge">linter.verify()</code> API accepted a <code class="language-plaintext highlighter-rouge">global</code> config option, which was a synonym for the documented <code class="language-plaintext highlighter-rouge">globals</code> property. The <code class="language-plaintext highlighter-rouge">global</code> option was never documented or officially supported, and did not work in config files. It has been removed in 4.0.</p>

<p><strong>To address:</strong> If you were using the <code class="language-plaintext highlighter-rouge">global</code> property, please use the <code class="language-plaintext highlighter-rouge">globals</code> property instead, which does the same thing.</p>

<h2 id="-more-report-messages-now-have-full-location-ranges"><a name="report-locations"></a> More report messages now have full location ranges</h2>

<p>Starting in 3.1.0, rules have been able to specify the <em>end</em> location of a reported problem, in addition to the start location, by explicitly specifying an end location in the <code class="language-plaintext highlighter-rouge">report</code> call. This is useful for tools like editor integrations, which can use the range to precisely display where a reported problem occurs. Starting in 4.0, if a <em>node</em> is reported rather than a location, the end location of the range will automatically be inferred from the end location of the node. As a result, many more reported problems will have end locations.</p>

<p>This is not expected to cause breakage. However, it will likely result in larger report locations than before. For example, if a rule reports the root node of the AST, the reported problem’s range will be the entire program. In some integrations, this could result in a poor user experience (e.g. if the entire program is highlighted to indicate an error).</p>

<p><strong>To address:</strong> If you have an integration that deals with the ranges of reported problems, make sure you handle large report ranges in a user-friendly way.</p>

<h2 id="-some-exposed-apis-are-now-es2015-classes"><a name="exposed-es2015-classes"></a> Some exposed APIs are now ES2015 classes</h2>

<p>The <code class="language-plaintext highlighter-rouge">CLIEngine</code>, <code class="language-plaintext highlighter-rouge">SourceCode</code>, and <code class="language-plaintext highlighter-rouge">RuleTester</code> modules from ESLint’s Node.js API are now ES2015 classes. This will not break any documented behavior, but it does have some observable effects (for example, the methods on <code class="language-plaintext highlighter-rouge">CLIEngine.prototype</code> are now non-enumerable).</p>

<p><strong>To address:</strong> If you rely on enumerating the methods of ESLint’s Node.js APIs, use a function that can also access non-enumerable properties such as <code class="language-plaintext highlighter-rouge">Object.getOwnPropertyNames</code>.</p>

  </article>
</main>

    <hr>

    <div class="container">

      <footer>
        <ul class="list-inline">
          
            <li><a href="https://github.com/eslint/eslint/edit/master/docs/user-guide/migrating-to-4.0.0.md">Edit this page</a></li>
          
          <li><a href="https://groups.google.com/group/eslint">Mailing List</a></li>
          <li><a href="https://github.com/eslint/eslint">GitHub</a></li>
          <li><a href="https://twitter.com/geteslint">Twitter</a></li>
          <li><a href="https://gitter.im/eslint/eslint">Chat Room</a></li>
          <li>Copyright JS Foundation and other contributors, <a href="https://js.foundation">https://js.foundation/</a></li>
        </ul>
      </footer>
    </div><!-- /.container -->

  <link href="/styles/vendor/font.css" rel="stylesheet">
  <script src="/js/vendor/jquery-1.10.2.min.js" defer></script>
  <script src="/js/vendor/bootstrap-native.min.js" defer></script>
  <script src="/js/vendor/anchor.min.js"></script>
      <!-- at the end of the BODY -->
  <script type="text/javascript" src="/js/vendor/docsearch.min.js"></script>
  <script type="text/javascript"> docsearch({
    apiKey: '891b0e977d96c762a3821e0c00172ac9',
    indexName: 'eslint',
    inputSelector: '#eslint-search-input',
    algoliaOptions: { 'facetFilters': [["tags:docs", "tags:blog"]] },
    debug: false // Set debug to true if you want to inspect the dropdown
  });
  var htmlClassList = document.documentElement.classList;
  htmlClassList.remove("no-js");
  htmlClassList.add("js");
  </script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      anchors.add('.doc h2, .doc h3, .doc h4, .blog h2, .blog h3, .blog h4');
      
	
  });
	
  </script>
  <style type="text/css">#cnzz_stat_icon_1278836435 {display: none;}</style>
  <script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1278836435'%3E%3C/span%3E%3Cscript src='https://s4.cnzz.com/z_stat.php%3Fid%3D1278836435%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
  
</body>
</html>

